<?php// Script para corrigir problemas no banco de dadosecho "<h1>üîß Corrigindo Banco de Dados</h1>";try {    // Conectar ao MySQL    $pdo = new PDO('mysql:host=localhost', 'root', '');    echo "<p style='color: green;'>‚úÖ Conectado ao MySQL</p>";        // Criar banco se n√£o existir    $pdo->exec("CREATE DATABASE IF NOT EXISTS `helpdesk_titanium` DEFAULT CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci");    echo "<p style='color: green;'>‚úÖ Banco 'helpdesk_titanium' criado/verificado</p>";        // Usar o banco    $pdo->exec("USE `helpdesk_titanium`");        // Criar tabela de usu√°rios se n√£o existir    $pdo->exec("        CREATE TABLE IF NOT EXISTS `users` (            `id` int(11) NOT NULL AUTO_INCREMENT,            `username` varchar(50) NOT NULL UNIQUE,            `email` varchar(100) NOT NULL UNIQUE,            `password` varchar(255) NOT NULL,            `name` varchar(100) NOT NULL,            `type` enum('user','support','admin') NOT NULL DEFAULT 'user',            `department` varchar(50) DEFAULT NULL,            `phone` varchar(20) DEFAULT NULL,            `created_at` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP,            `updated_at` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,            `is_active` tinyint(1) NOT NULL DEFAULT 1,            PRIMARY KEY (`id`)        ) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci    ");    echo "<p style='color: green;'>‚úÖ Tabela 'users' criada/verificada</p>";        // Criar tabela de status de tickets    $pdo->exec("        CREATE TABLE IF NOT EXISTS `ticket_statuses` (            `id` int(11) NOT NULL AUTO_INCREMENT,            `name` varchar(50) NOT NULL,            `slug` varchar(50) NOT NULL UNIQUE,            `description` text,            `color` varchar(7) DEFAULT '#3b82f6',            `created_at` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP,            PRIMARY KEY (`id`)        ) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci    ");    echo "<p style='color: green;'>‚úÖ Tabela 'ticket_statuses' criada/verificada</p>";        // Criar tabela de categorias de tickets    $pdo->exec("        CREATE TABLE IF NOT EXISTS `ticket_categories` (            `id` int(11) NOT NULL AUTO_INCREMENT,            `name` varchar(100) NOT NULL,            `description` text,            `color` varchar(7) DEFAULT '#6b7280',            `created_at` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP,            PRIMARY KEY (`id`)        ) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci    ");    echo "<p style='color: green;'>‚úÖ Tabela 'ticket_categories' criada/verificada</p>";        // Criar tabela de tickets    $pdo->exec("        CREATE TABLE IF NOT EXISTS `tickets` (            `id` int(11) NOT NULL AUTO_INCREMENT,            `user_id` int(11) NOT NULL,            `title` varchar(255) NOT NULL,            `description` text NOT NULL,            `priority` enum('low','medium','high','urgent') NOT NULL DEFAULT 'medium',            `status_id` int(11) NOT NULL DEFAULT 1,            `category_id` int(11) NOT NULL,            `assigned_to` int(11) DEFAULT NULL,            `created_at` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP,            `updated_at` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,            `resolved_at` timestamp NULL DEFAULT NULL,            PRIMARY KEY (`id`),            KEY `user_id` (`user_id`),            KEY `status_id` (`status_id`),            KEY `category_id` (`category_id`),            KEY `assigned_to` (`assigned_to`)        ) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci    ");    echo "<p style='color: green;'>‚úÖ Tabela 'tickets' criada/verificada</p>";        // Inserir dados iniciais    echo "<h2>Inserindo dados iniciais...</h2>";        // Inserir status de tickets    $pdo->exec("        INSERT IGNORE INTO `ticket_statuses` (`name`, `slug`, `description`, `color`) VALUES        ('Aberto', 'open', 'Ticket rec√©m-criado', '#3b82f6'),        ('Em Andamento', 'in_progress', 'Ticket sendo trabalhado', '#f59e0b'),        ('Resolvido', 'resolved', 'Ticket resolvido', '#10b981'),        ('Fechado', 'closed', 'Ticket fechado', '#6b7280')    ");    echo "<p style='color: green;'>‚úÖ Status de tickets inseridos</p>";        // Inserir categorias de tickets    $pdo->exec("        INSERT IGNORE INTO `ticket_categories` (`name`, `description`, `color`) VALUES        ('Hardware', 'Problemas com equipamentos', '#ef4444'),        ('Software', 'Problemas com programas', '#3b82f6'),        ('Rede', 'Problemas de conectividade', '#10b981'),        ('Acesso', 'Solicita√ß√µes de acesso', '#f59e0b'),        ('Sistema', 'Problemas do sistema', '#8b5cf6'),        ('Relat√≥rios', 'Problemas com relat√≥rios', '#06b6d4')    ");    echo "<p style='color: green;'>‚úÖ Categorias de tickets inseridas</p>";        // Verificar se h√° usu√°rios    $stmt = $pdo->query("SELECT COUNT(*) as count FROM users");    $userCount = $stmt->fetch()['count'];        if ($userCount == 0) {        // Inserir usu√°rio admin        $passwordHash = password_hash('Controll IT@10', PASSWORD_DEFAULT);        $pdo->exec("            INSERT INTO `users` (`username`, `email`, `password`, `name`, `type`, `department`, `phone`) VALUES            ('admin', 'admin@controllit.com.br', '$passwordHash', 'Administrador do Sistema', 'admin', 'TI', '11999999999')        ");        echo "<p style='color: green;'>‚úÖ Usu√°rio admin criado</p>";    } else {        echo "<p style='color: blue;'>‚ÑπÔ∏è Usu√°rios j√° existem ($userCount usu√°rios)</p>";    }        // Verificar se h√° tickets    $stmt = $pdo->query("SELECT COUNT(*) as count FROM tickets");    $ticketCount = $stmt->fetch()['count'];        if ($ticketCount == 0) {        // Inserir alguns tickets de exemplo        $pdo->exec("            INSERT INTO `tickets` (`user_id`, `title`, `description`, `priority`, `status_id`, `category_id`) VALUES            (1, 'Problema com Login', 'N√£o consigo fazer login no sistema', 'high', 1, 5),            (1, 'Solicita√ß√£o de Acesso', 'Preciso de acesso ao sistema de vendas', 'medium', 1, 4),            (1, 'Bug no Relat√≥rio', 'Relat√≥rio de vendas n√£o est√° funcionando', 'low', 1, 6)        ");        echo "<p style='color: green;'>‚úÖ Tickets de exemplo criados</p>";    } else {        echo "<p style='color: blue;'>‚ÑπÔ∏è Tickets j√° existem ($ticketCount tickets)</p>";    }        echo "<h2>‚úÖ Banco de dados corrigido com sucesso!</h2>";    echo "<p><a href='debug_detailed.php'>Executar debug detalhado</a></p>";    echo "<p><a href='index.html'>Testar sistema</a></p>";    } catch (Exception $e) {    echo "<p style='color: red;'>‚ùå Erro: " . $e->getMessage() . "</p>";}?>