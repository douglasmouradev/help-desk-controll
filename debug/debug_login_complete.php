<?php// Diagn√≥stico completo do loginerror_reporting(E_ALL);ini_set('display_errors', 1);echo "<h1>üîç Diagn√≥stico Completo do Login</h1>";try {    // Conectar ao banco    $pdo = new PDO('mysql:host=localhost;dbname=helpdesk_titanium', 'root', '');    echo "‚úÖ Conex√£o com banco: OK<br>";        echo "<h2>1. Verificar Usu√°rios no Banco:</h2>";    $stmt = $pdo->query("SELECT id, username, email, type, password FROM users");    $users = $stmt->fetchAll(PDO::FETCH_ASSOC);        echo "<table border='1' style='border-collapse: collapse;'>";    echo "<tr><th>ID</th><th>Username</th><th>Email</th><th>Tipo</th><th>Hash (primeiros 20 chars)</th></tr>";    foreach ($users as $user) {        echo "<tr>";        echo "<td>" . $user['id'] . "</td>";        echo "<td>" . $user['username'] . "</td>";        echo "<td>" . $user['email'] . "</td>";        echo "<td>" . $user['type'] . "</td>";        echo "<td>" . substr($user['password'], 0, 20) . "...</td>";        echo "</tr>";    }    echo "</table>";        echo "<h2>2. Testar Senhas:</h2>";    $testPasswords = ['Controll IT@10', 'senha123', 'admin', 'password'];        foreach ($testPasswords as $testPassword) {        echo "<h3>Testando senha: '$testPassword'</h3>";                foreach ($users as $user) {            $isValid = password_verify($testPassword, $user['password']);            $status = $isValid ? "‚úÖ V√ÅLIDA" : "‚ùå INV√ÅLIDA";            echo "Usu√°rio {$user['username']}: $status<br>";        }    }        echo "<h2>3. Simular Login da API:</h2>";        // Simular exatamente o que a API faz    $username = 'admin';    $password = 'Controll IT@10';        echo "Tentando login com: $username / $password<br>";        // Buscar usu√°rio por username OU email    $stmt = $pdo->prepare("SELECT * FROM users WHERE username = ? OR email = ?");    $stmt->execute([$username, $username]);    $user = $stmt->fetch(PDO::FETCH_ASSOC);        if ($user) {        echo "‚úÖ Usu√°rio encontrado: {$user['username']}<br>";        echo "Email: {$user['email']}<br>";        echo "Tipo: {$user['type']}<br>";                // Verificar senha        $isValid = password_verify($password, $user['password']);        echo "Verifica√ß√£o de senha: " . ($isValid ? "‚úÖ V√ÅLIDA" : "‚ùå INV√ÅLIDA") . "<br>";                if ($isValid) {            echo "<strong>üéâ LOGIN DEVERIA FUNCIONAR!</strong><br>";        } else {            echo "<strong>‚ùå PROBLEMA: Senha n√£o confere!</strong><br>";            echo "Hash no banco: " . substr($user['password'], 0, 30) . "...<br>";                        // Gerar novo hash            $newHash = password_hash($password, PASSWORD_BCRYPT, ['cost' => 12]);            echo "Novo hash gerado: " . substr($newHash, 0, 30) . "...<br>";                        // Atualizar no banco            $updateStmt = $pdo->prepare("UPDATE users SET password = ? WHERE id = ?");            $updateStmt->execute([$newHash, $user['id']]);            echo "‚úÖ Senha atualizada no banco!<br>";                        // Testar novamente            $isValidNow = password_verify($password, $newHash);            echo "Teste ap√≥s atualiza√ß√£o: " . ($isValidNow ? "‚úÖ V√ÅLIDA" : "‚ùå INV√ÅLIDA") . "<br>";        }    } else {        echo "‚ùå Usu√°rio n√£o encontrado!<br>";    }        echo "<h2>4. Verificar API auth.php:</h2>";    if (file_exists('api/auth.php')) {        echo "‚úÖ Arquivo api/auth.php existe<br>";                // Verificar se h√° erros de sintaxe        $syntaxCheck = shell_exec('php -l api/auth.php 2>&1');        echo "Verifica√ß√£o de sintaxe: $syntaxCheck<br>";    } else {        echo "‚ùå Arquivo api/auth.php n√£o encontrado!<br>";    }        echo "<h2>5. Testar API Diretamente:</h2>";    echo "<form method='post' action='api/auth.php'>";    echo "<input type='hidden' name='action' value='login'>";    echo "<input type='hidden' name='username' value='admin'>";    echo "<input type='hidden' name='password' value='Controll IT@10'>";    echo "<button type='submit'>Testar API Diretamente</button>";    echo "</form>";    } catch (PDOException $e) {    echo "‚ùå Erro na conex√£o: " . $e->getMessage() . "<br>";}echo "<hr>";echo "<h2>üìã Resumo:</h2>";echo "<p>Se tudo estiver OK acima, o problema pode estar na API ou no frontend.</p>";echo "<p><strong>Teste:</strong> <a href='http://localhost/sistema-web-Controll IT/'>Sistema Principal</a></p>";?>