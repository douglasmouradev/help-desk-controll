<?php// Diagn√≥stico detalhado do loginerror_reporting(E_ALL);ini_set('display_errors', 1);echo "<h1>üîç Diagn√≥stico Detalhado do Login</h1>";try {    // Conectar ao banco    $pdo = new PDO('mysql:host=localhost;dbname=helpdesk_titanium', 'root', '');    echo "‚úÖ Conex√£o com banco: OK<br>";        echo "<h2>1. Verificar Usu√°rio Admin:</h2>";    $stmt = $pdo->prepare("SELECT * FROM users WHERE username = 'admin'");    $stmt->execute();    $user = $stmt->fetch(PDO::FETCH_ASSOC);        if ($user) {        echo "‚úÖ Usu√°rio admin encontrado:<br>";        echo "ID: " . $user['id'] . "<br>";        echo "Username: " . $user['username'] . "<br>";        echo "Email: " . $user['email'] . "<br>";        echo "Type: " . $user['type'] . "<br>";        echo "Active: " . $user['is_active'] . "<br>";        echo "Hash: " . substr($user['password'], 0, 30) . "...<br>";    } else {        echo "‚ùå Usu√°rio admin n√£o encontrado!<br>";    }        echo "<h2>2. Testar Senha Controll IT@10:</h2>";    $testPassword = 'Controll IT@10';    $isValid = password_verify($testPassword, $user['password']);    echo "Senha '$testPassword': " . ($isValid ? "‚úÖ V√ÅLIDA" : "‚ùå INV√ÅLIDA") . "<br>";        if (!$isValid) {        echo "<h3>üîß Corrigindo senha...</h3>";        $newHash = password_hash($testPassword, PASSWORD_BCRYPT, ['cost' => 12]);        $updateStmt = $pdo->prepare("UPDATE users SET password = ? WHERE username = 'admin'");        $updateStmt->execute([$newHash]);        echo "‚úÖ Senha atualizada!<br>";                // Testar novamente        $isValidNow = password_verify($testPassword, $newHash);        echo "Teste ap√≥s corre√ß√£o: " . ($isValidNow ? "‚úÖ V√ÅLIDA" : "‚ùå INV√ÅLIDA") . "<br>";    }        echo "<h2>3. Simular API de Login:</h2>";        // Simular exatamente o que a API faz    $username = 'admin';    $password = 'Controll IT@10';        echo "Tentando login: $username / $password<br>";        // Buscar usu√°rio    $stmt = $pdo->prepare("SELECT * FROM users WHERE (username = ? OR email = ?) AND is_active = 1");    $stmt->execute([$username, $username]);    $user = $stmt->fetch(PDO::FETCH_ASSOC);        if ($user) {        echo "‚úÖ Usu√°rio encontrado no banco<br>";        echo "Username: " . $user['username'] . "<br>";        echo "Type: " . $user['type'] . "<br>";                // Verificar senha        $isValid = password_verify($password, $user['password']);        echo "Verifica√ß√£o de senha: " . ($isValid ? "‚úÖ V√ÅLIDA" : "‚ùå INV√ÅLIDA") . "<br>";                if ($isValid) {            echo "<h3>üéâ LOGIN DEVERIA FUNCIONAR!</h3>";            echo "Dados que seriam retornados:<br>";            echo "Token: [seria gerado]<br>";            echo "User: " . json_encode([                'id' => $user['id'],                'username' => $user['username'],                'name' => $user['name'],                'email' => $user['email'],                'type' => $user['type']            ], JSON_PRETTY_PRINT) . "<br>";        } else {            echo "<h3>‚ùå PROBLEMA: Senha n√£o confere!</h3>";        }    } else {        echo "‚ùå Usu√°rio n√£o encontrado!<br>";    }        echo "<h2>4. Testar API Diretamente:</h2>";    echo "<form method='post' action='api/auth.php' style='border: 1px solid #ccc; padding: 10px; margin: 10px 0;'>";    echo "<input type='hidden' name='action' value='login'>";    echo "<input type='hidden' name='username' value='admin'>";    echo "<input type='hidden' name='password' value='Controll IT@10'>";    echo "<button type='submit' style='background: #007bff; color: white; padding: 10px 20px; border: none; border-radius: 5px;'>Testar API Diretamente</button>";    echo "</form>";        echo "<h2>5. Verificar Logs de Erro:</h2>";    $errorLog = ini_get('error_log');    echo "Log de erros: $errorLog<br>";        if (file_exists($errorLog)) {        $errors = file_get_contents($errorLog);        $recentErrors = array_slice(explode("\n", $errors), -10);        echo "√öltimos 10 erros:<br>";        echo "<pre>" . implode("\n", $recentErrors) . "</pre>";    }    } catch (PDOException $e) {    echo "‚ùå Erro na conex√£o: " . $e->getMessage() . "<br>";}echo "<hr>";echo "<h2>üìã Resumo:</h2>";echo "<p>Se tudo estiver OK acima, o problema pode estar na comunica√ß√£o entre frontend e API.</p>";echo "<p><strong>Teste:</strong> <a href='http://localhost/sistema-web-Controll IT/'>Sistema Principal</a></p>";?>