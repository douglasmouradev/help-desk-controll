# Guia de Instalação - Sistema Help Desk Controll IT## Pré-requisitos### Servidor Web- **Apache 2.4+** ou **Nginx 1.18+**- **PHP 7.4+** (recomendado PHP 8.0+)- **MySQL 5.7+** ou **MariaDB 10.3+**### Extensões PHP Necessárias```bashphp-mysqlphp-jsonphp-curlphp-mbstringphp-openssl```### Ferramentas de Desenvolvimento (Opcional)- **Composer** (para gerenciamento de dependências)- **Git** (para controle de versão)## Instalação Passo a Passo### 1. Preparação do Ambiente#### Ubuntu/Debian```bash# Atualizar sistemasudo apt update && sudo apt upgrade -y# Instalar Apache, PHP e MySQLsudo apt install apache2 php php-mysql php-json php-curl php-mbstring php-openssl mysql-server -y# Habilitar mod_rewritesudo a2enmod rewritesudo systemctl restart apache2```#### CentOS/RHEL```bash# Instalar EPEL repositorysudo yum install epel-release -y# Instalar Apache, PHP e MySQLsudo yum install httpd php php-mysqlnd php-json php-curl php-mbstring php-openssl mariadb-server -y# Iniciar serviçossudo systemctl start httpd mariadbsudo systemctl enable httpd mariadb```#### Windows (XAMPP/WAMP)1. Baixe e instale [XAMPP](https://www.apachefriends.org/) ou [WAMP](https://www.wampserver.com/)2. Inicie Apache e MySQL3. Acesse o painel de controle do XAMPP/WAMP### 2. Configuração do Banco de Dados#### Criar Banco de Dados```sql-- Conectar ao MySQL como rootmysql -u root -p-- Criar banco de dadosCREATE DATABASE helpdesk_titanium CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;-- Criar usuário específico (opcional, mas recomendado)CREATE USER 'helpdesk_user'@'localhost' IDENTIFIED BY 'senha_segura_123';GRANT ALL PRIVILEGES ON helpdesk_titanium.* TO 'helpdesk_user'@'localhost';FLUSH PRIVILEGES;-- Selecionar o bancoUSE helpdesk_titanium;```#### Importar Estrutura```bash# Importar o schema do bancomysql -u root -p helpdesk_titanium < database_schema.sql```### 3. Configuração dos Arquivos#### Estrutura de Diretórios```/var/www/html/helpdesk/├── api/│   ├── config.php│   ├── auth.php│   ├── tickets.php│   ├── users.php│   └── index.php├── uploads/├── index.html├── styles.css├── script-api.js└── favicon.svg```#### Configurar Permissões```bash# Criar diretório de uploadssudo mkdir -p /var/www/html/helpdesk/uploadssudo chmod 755 /var/www/html/helpdesk/uploadssudo chown www-data:www-data /var/www/html/helpdesk/uploads# Configurar permissões dos arquivossudo chmod 644 /var/www/html/helpdesk/api/*.phpsudo chmod 644 /var/www/html/helpdesk/*.htmlsudo chmod 644 /var/www/html/helpdesk/*.csssudo chmod 644 /var/www/html/helpdesk/*.js```#### Editar Configuração do Banco```php// Editar api/config.phpdefine('DB_HOST', 'localhost');define('DB_NAME', 'helpdesk_titanium');define('DB_USER', 'helpdesk_user');  // ou 'root'define('DB_PASS', 'senha_segura_123');  // sua senha```### 4. Configuração do Apache#### Virtual Host (Recomendado)```apache# /etc/apache2/sites-available/helpdesk.conf<VirtualHost *:80>    ServerName helpdesk.Controll IT.com    DocumentRoot /var/www/html/helpdesk        <Directory /var/www/html/helpdesk>        AllowOverride All        Require all granted    </Directory>        # Configurar CORS para API    <Directory /var/www/html/helpdesk/api>        Header always set Access-Control-Allow-Origin "*"        Header always set Access-Control-Allow-Methods "GET, POST, PUT, DELETE, OPTIONS"        Header always set Access-Control-Allow-Headers "Content-Type, Authorization"                # Tratar requisições OPTIONS        RewriteEngine On        RewriteCond %{REQUEST_METHOD} OPTIONS        RewriteRule ^(.*)$ $1 [R=200,L]    </Directory>        # Logs    ErrorLog ${APACHE_LOG_DIR}/helpdesk_error.log    CustomLog ${APACHE_LOG_DIR}/helpdesk_access.log combined</VirtualHost>```#### Habilitar Site```bash# Habilitar sitesudo a2ensite helpdesk.conf# Recarregar Apachesudo systemctl reload apache2```### 5. Configuração de Segurança#### Configurar HTTPS (Recomendado)```bash# Instalar Certbotsudo apt install certbot python3-certbot-apache -y# Obter certificado SSLsudo certbot --apache -d helpdesk.Controll IT.com```#### Configurar Firewall```bash# Ubuntu/Debian (UFW)sudo ufw allow 22/tcpsudo ufw allow 80/tcpsudo ufw allow 443/tcpsudo ufw enable# CentOS/RHEL (firewalld)sudo firewall-cmd --permanent --add-service=sshsudo firewall-cmd --permanent --add-service=httpsudo firewall-cmd --permanent --add-service=httpssudo firewall-cmd --reload```### 6. Configuração do Sistema#### Criar Usuário Administrador```sql-- Conectar ao bancomysql -u root -p helpdesk_titanium-- Alterar senha do admin padrãoUPDATE users SET password_hash = '$2y$10$92IXUNpkjO0rOQ5byMi.Ye4oKoEa3Ro9llC/.og/at2.uheWG/igi' WHERE username = 'admin';-- Senha padrão: 'password' (ALTERE IMEDIATAMENTE)```#### Configurar Variáveis de Ambiente```bash# Criar arquivo .env (opcional)sudo nano /var/www/html/helpdesk/.env# Conteúdo:DB_HOST=localhostDB_NAME=helpdesk_titaniumDB_USER=helpdesk_userDB_PASS=senha_segura_123JWT_SECRET=sua_chave_secreta_muito_forte_aqui```### 7. Teste da Instalação#### Verificar Funcionamento1. **Acesse o sistema:** `http://helpdesk.Controll IT.com`2. **Teste login:** Use as credenciais de demonstração3. **Verifique logs:** `/var/log/apache2/helpdesk_error.log`#### Testar API```bash# Teste de login via curlcurl -X POST http://helpdesk.Controll IT.com/api/auth/login \  -H "Content-Type: application/json" \  -d '{"username":"admin","password":"password"}'```### 8. Configurações Avançadas#### Otimização do PHP```ini# /etc/php/8.0/apache2/php.iniupload_max_filesize = 10Mpost_max_size = 10Mmax_execution_time = 30memory_limit = 256M```#### Backup Automático```bash# Criar script de backupsudo nano /usr/local/bin/backup-helpdesk.sh#!/bin/bashDATE=$(date +%Y%m%d_%H%M%S)BACKUP_DIR="/backup/helpdesk"DB_NAME="helpdesk_titanium"mkdir -p $BACKUP_DIR# Backup do bancomysqldump -u root -p$DB_PASS $DB_NAME > $BACKUP_DIR/helpdesk_$DATE.sql# Backup dos arquivostar -czf $BACKUP_DIR/helpdesk_files_$DATE.tar.gz /var/www/html/helpdesk# Manter apenas últimos 7 backupsfind $BACKUP_DIR -name "helpdesk_*" -mtime +7 -delete# Executar backup diário às 2hsudo chmod +x /usr/local/bin/backup-helpdesk.shecho "0 2 * * * /usr/local/bin/backup-helpdesk.sh" | sudo crontab -```#### Monitoramento```bash# Instalar ferramentas de monitoramentosudo apt install htop iotop nethogs -y# Monitorar logs em tempo realsudo tail -f /var/log/apache2/helpdesk_access.log```## Configuração para Produção### 1. Segurança Avançada#### Ocultar Versão do Apache```apache# Adicionar ao VirtualHostServerTokens ProdServerSignature Off```#### Configurar Headers de Segurança```apache# Adicionar ao VirtualHostHeader always set X-Content-Type-Options nosniffHeader always set X-Frame-Options DENYHeader always set X-XSS-Protection "1; mode=block"Header always set Strict-Transport-Security "max-age=31536000; includeSubDomains"```### 2. Performance#### Habilitar Compressão```apache# Adicionar ao VirtualHostLoadModule deflate_module modules/mod_deflate.so<Location />    SetOutputFilter DEFLATE    SetEnvIfNoCase Request_URI \        \.(?:gif|jpe?g|png)$ no-gzip dont-vary    SetEnvIfNoCase Request_URI \        \.(?:exe|t?gz|zip|bz2|sit|rar)$ no-gzip dont-vary</Location>```#### Configurar Cache```apache# Adicionar ao VirtualHost<IfModule mod_expires.c>    ExpiresActive on    ExpiresByType text/css "access plus 1 month"    ExpiresByType application/javascript "access plus 1 month"    ExpiresByType image/png "access plus 1 month"    ExpiresByType image/jpg "access plus 1 month"    ExpiresByType image/jpeg "access plus 1 month"</IfModule>```### 3. Backup e Recuperação#### Script de Restauração```bash#!/bin/bash# restore-helpdesk.shBACKUP_FILE=$1if [ -z "$BACKUP_FILE" ]; then    echo "Uso: $0 <arquivo_backup>"    exit 1fi# Restaurar bancomysql -u root -p helpdesk_titanium < $BACKUP_FILE# Restaurar arquivos (se necessário)# tar -xzf $BACKUP_FILE -C /echo "Restauração concluída!"```## Troubleshooting### Problemas Comuns#### 1. Erro 500 - Internal Server Error```bash# Verificar logssudo tail -f /var/log/apache2/error.log# Verificar permissõesls -la /var/www/html/helpdesk/sudo chown -R www-data:www-data /var/www/html/helpdesk/```#### 2. Erro de Conexão com Banco```bash# Testar conexãomysql -u helpdesk_user -p -h localhost helpdesk_titanium# Verificar configuraçãocat /var/www/html/helpdesk/api/config.php```#### 3. Problemas de CORS```bash# Verificar headerscurl -I http://helpdesk.Controll IT.com/api/tickets# Verificar configuração Apachesudo apache2ctl -S```#### 4. Upload de Arquivos Falhando```bash# Verificar permissõesls -la /var/www/html/helpdesk/uploads/# Verificar configuração PHPphp -i | grep upload```### Logs Importantes```bash# Logs do Apachesudo tail -f /var/log/apache2/helpdesk_access.logsudo tail -f /var/log/apache2/helpdesk_error.log# Logs do MySQLsudo tail -f /var/log/mysql/error.log# Logs do PHPsudo tail -f /var/log/php8.0-fpm.log```## Manutenção### Atualizações de Segurança```bash# Atualizar sistemasudo apt update && sudo apt upgrade -y# Reiniciar serviçossudo systemctl restart apache2 mysql```### Limpeza de Logs```bash# Rotacionar logs automaticamentesudo logrotate -f /etc/logrotate.d/apache2# Limpar logs antigossudo find /var/log -name "*.log" -mtime +30 -delete```### Monitoramento de Espaço```bash# Verificar uso de discodf -h# Verificar tamanho dos logssudo du -sh /var/log/apache2/```## SuportePara suporte técnico ou dúvidas sobre a instalação:1. **Verifique os logs** primeiro2. **Consulte a documentação** da API3. **Teste em ambiente de desenvolvimento** antes de aplicar em produção4. **Mantenha backups** regulares---**Sistema Help Desk Controll IT** - Instalação e Configuração