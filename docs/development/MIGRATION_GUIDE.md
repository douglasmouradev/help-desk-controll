# Guia de MigraÃ§Ã£o - Sistema Help Desk TITANIUMEste guia explica como migrar do sistema atual (que usa LocalStorage) para o sistema completo com banco de dados e API backend.## VisÃ£o Geral da MigraÃ§Ã£o### Sistema Atual (LocalStorage)- âœ… Frontend completo e funcional- âŒ Dados armazenados apenas no navegador- âŒ Sem persistÃªncia entre dispositivos- âŒ Sem controle de usuÃ¡rios centralizado### Sistema Completo (Banco + API)- âœ… Frontend completo e funcional- âœ… Banco de dados MySQL/MariaDB- âœ… API RESTful em PHP- âœ… AutenticaÃ§Ã£o JWT segura- âœ… PersistÃªncia de dados- âœ… Controle de usuÃ¡rios centralizado- âœ… Logs de auditoria- âœ… Sistema de permissÃµes robusto## Passos da MigraÃ§Ã£o### 1. PreparaÃ§Ã£o do Ambiente#### Instalar DependÃªncias```bash# Ubuntu/Debiansudo apt updatesudo apt install apache2 php php-mysql php-json php-curl php-mbstring php-openssl mysql-server -y# CentOS/RHELsudo yum install httpd php php-mysqlnd php-json php-curl php-mbstring php-openssl mariadb-server -y```#### Configurar Banco de Dados```bash# Conectar ao MySQLmysql -u root -p# Criar bancoCREATE DATABASE helpdesk_titanium CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;CREATE USER 'helpdesk_user'@'localhost' IDENTIFIED BY 'senha_segura_123';GRANT ALL PRIVILEGES ON helpdesk_titanium.* TO 'helpdesk_user'@'localhost';FLUSH PRIVILEGES;```### 2. Estrutura de Arquivos#### Organizar Arquivos```/var/www/html/helpdesk/â”œâ”€â”€ api/                    # Backend PHPâ”‚   â”œâ”€â”€ config.php         # ConfiguraÃ§Ãµesâ”‚   â”œâ”€â”€ auth.php           # AutenticaÃ§Ã£oâ”‚   â”œâ”€â”€ tickets.php        # GestÃ£o de chamadosâ”‚   â”œâ”€â”€ users.php          # GestÃ£o de usuÃ¡riosâ”‚   â””â”€â”€ index.php          # Router da APIâ”œâ”€â”€ uploads/               # Arquivos enviadosâ”œâ”€â”€ index.html             # Frontend (atual)â”œâ”€â”€ styles.css             # CSS (atual)â”œâ”€â”€ script-api.js          # JavaScript com API (novo)â”œâ”€â”€ script.js              # JavaScript original (manter como backup)â””â”€â”€ favicon.svg            # Ãcone (atual)```### 3. ConfiguraÃ§Ã£o do Backend#### Configurar ConexÃ£o com Banco```php// Editar api/config.phpdefine('DB_HOST', 'localhost');define('DB_NAME', 'helpdesk_titanium');define('DB_USER', 'helpdesk_user');define('DB_PASS', 'senha_segura_123');define('JWT_SECRET', 'sua_chave_secreta_muito_forte_aqui');```#### Importar Estrutura do Banco```bash# Importar schemamysql -u root -p helpdesk_titanium < database_schema.sql```### 4. MigraÃ§Ã£o do Frontend#### Atualizar index.html```html<!-- Substituir a linha do script --><!-- DE: --><script src="script.js"></script><!-- PARA: --><script src="script-api.js"></script>```#### Configurar URL da API```javascript// No script-api.js, linha 7this.apiBaseUrl = '/api/';  // Para produÃ§Ã£o// outhis.apiBaseUrl = 'http://localhost/helpdesk/api/';  // Para desenvolvimento```### 5. MigraÃ§Ã£o de Dados (Opcional)Se vocÃª tem dados importantes no sistema atual, pode migrÃ¡-los:#### Script de MigraÃ§Ã£o de Dados```php<?php// migrate-data.phprequire_once 'api/config.php';function migrateLocalStorageData() {    $db = new Database();    $conn = $db->getConnection();        // Dados de exemplo para migraÃ§Ã£o    $demoUsers = [        [            'name' => 'UsuÃ¡rio PadrÃ£o',            'email' => 'usuario@controllit.com.br',            'username' => 'usuario',            'password' => password_hash('senha123', PASSWORD_DEFAULT),            'user_type' => 'user'        ],        [            'name' => 'Agente de Suporte',            'email' => 'suporte@controllit.com.br',            'username' => 'suporte',            'password' => password_hash('senha123', PASSWORD_DEFAULT),            'user_type' => 'support'        ],        [            'name' => 'Administrador',            'email' => 'admin@controllit.com.br',            'username' => 'admin',            'password' => password_hash('senha123', PASSWORD_DEFAULT),            'user_type' => 'admin'        ]    ];        foreach ($demoUsers as $user) {        $stmt = $conn->prepare("            INSERT INTO users (name, email, username, password_hash, user_type)             VALUES (?, ?, ?, ?, ?)        ");        $stmt->execute([            $user['name'],            $user['email'],            $user['username'],            $user['password'],            $user['user_type']        ]);    }        echo "UsuÃ¡rios migrados com sucesso!\n";}migrateLocalStorageData();?>```### 6. ConfiguraÃ§Ã£o do Servidor Web#### Apache Virtual Host```apache<VirtualHost *:80>    ServerName helpdesk.Controll IT.com    DocumentRoot /var/www/html/helpdesk        <Directory /var/www/html/helpdesk>        AllowOverride All        Require all granted    </Directory>        # Configurar CORS para API    <Directory /var/www/html/helpdesk/api>        Header always set Access-Control-Allow-Origin "*"        Header always set Access-Control-Allow-Methods "GET, POST, PUT, DELETE, OPTIONS"        Header always set Access-Control-Allow-Headers "Content-Type, Authorization"    </Directory></VirtualHost>```#### Configurar .htaccess```apache# /var/www/html/helpdesk/.htaccessRewriteEngine On# Redirecionar API requestsRewriteCond %{REQUEST_URI} ^/api/(.*)$RewriteRule ^api/(.*)$ api/index.php [QSA,L]# Servir arquivos estÃ¡ticosRewriteCond %{REQUEST_FILENAME} !-fRewriteCond %{REQUEST_FILENAME} !-dRewriteRule ^(.*)$ index.html [QSA,L]```### 7. Teste da MigraÃ§Ã£o#### Verificar Funcionamento1. **Acesse o sistema:** `http://helpdesk.Controll IT.com`2. **Teste login:** Use as credenciais padrÃ£o3. **Crie um chamado:** Verifique se Ã© salvo no banco4. **Verifique logs:** `/var/log/apache2/error.log`#### Testar API```bash# Teste de logincurl -X POST http://helpdesk.Controll IT.com/api/auth/login \  -H "Content-Type: application/json" \  -d '{"username":"admin","password":"senha123"}'# Teste de listagem de chamadoscurl -X GET http://helpdesk.Controll IT.com/api/tickets \  -H "Authorization: Bearer SEU_TOKEN_AQUI"```### 8. ConfiguraÃ§Ãµes de ProduÃ§Ã£o#### SeguranÃ§a```bash# Configurar HTTPSsudo certbot --apache -d helpdesk.Controll IT.com# Configurar firewallsudo ufw allow 22/tcpsudo ufw allow 80/tcpsudo ufw allow 443/tcpsudo ufw enable```#### Backup```bash# Script de backup automÃ¡tico#!/bin/bashDATE=$(date +%Y%m%d_%H%M%S)mysqldump -u root -p helpdesk_titanium > /backup/helpdesk_$DATE.sqltar -czf /backup/helpdesk_files_$DATE.tar.gz /var/www/html/helpdesk```## ComparaÃ§Ã£o: Antes vs Depois### Funcionalidades Mantidas- âœ… Interface visual idÃªntica- âœ… Todos os recursos do frontend- âœ… Responsividade- âœ… NavegaÃ§Ã£o entre pÃ¡ginas- âœ… Modais e interaÃ§Ãµes### Melhorias Adicionadas- ğŸ”’ **SeguranÃ§a:** AutenticaÃ§Ã£o JWT, validaÃ§Ã£o server-side- ğŸ’¾ **PersistÃªncia:** Dados salvos no banco de dados- ğŸ‘¥ **Multi-usuÃ¡rio:** Controle centralizado de usuÃ¡rios- ğŸ“Š **RelatÃ³rios:** Analytics e estatÃ­sticas avanÃ§adas- ğŸ“ **Auditoria:** Logs de todas as atividades- ğŸ”„ **Escalabilidade:** API permite integraÃ§Ã£o com outros sistemas### Novas Funcionalidades- **Upload de arquivos:** Anexos nos chamados- **ComentÃ¡rios internos:** Para agentes de suporte- **HistÃ³rico de alteraÃ§Ãµes:** Rastreamento completo- **NotificaÃ§Ãµes:** Sistema de alertas- **API RESTful:** IntegraÃ§Ã£o com sistemas externos## Rollback (Volta ao Sistema Anterior)Se necessÃ¡rio voltar ao sistema anterior:### 1. Restaurar Frontend Original```bash# Fazer backup do atualcp index.html index-api.htmlcp script-api.js script-api-backup.js# Restaurar originalcp index.html.backup index.html# Alterar script para usar script.js original```### 2. Limpar Banco de Dados (Opcional)```sqlDROP DATABASE helpdesk_titanium;```### 3. Restaurar ConfiguraÃ§Ã£o Apache```bash# Desabilitar sitesudo a2dissite helpdesk.confsudo systemctl reload apache2```## Troubleshooting### Problemas Comuns#### 1. Erro 404 na API```bash# Verificar configuraÃ§Ã£o do Apachesudo apache2ctl -S# Verificar .htaccesscat /var/www/html/helpdesk/.htaccess```#### 2. Erro de CORS```bash# Verificar headerscurl -I http://helpdesk.Controll IT.com/api/tickets# Verificar configuraÃ§Ã£o CORS no Apache```#### 3. Erro de ConexÃ£o com Banco```bash# Testar conexÃ£omysql -u helpdesk_user -p -h localhost helpdesk_titanium# Verificar logs do MySQLsudo tail -f /var/log/mysql/error.log```#### 4. Token JWT InvÃ¡lido```javascript// Verificar configuraÃ§Ã£o no script-api.jsthis.apiBaseUrl = '/api/';  // Deve estar correto// Verificar JWT_SECRET no config.phpdefine('JWT_SECRET', 'sua_chave_secreta_muito_forte_aqui');```### Logs para Debug```bash# Logs do Apachesudo tail -f /var/log/apache2/helpdesk_error.log# Logs do PHPsudo tail -f /var/log/php8.0-fpm.log# Logs do MySQLsudo tail -f /var/log/mysql/error.log# Logs da aplicaÃ§Ã£o (tabela access_logs)mysql -u root -p helpdesk_titanium -e "SELECT * FROM access_logs ORDER BY created_at DESC LIMIT 10;"```## PrÃ³ximos PassosApÃ³s a migraÃ§Ã£o bem-sucedida:1. **Treinar usuÃ¡rios** nas novas funcionalidades2. **Configurar backups** automÃ¡ticos3. **Implementar monitoramento** do sistema4. **Planejar atualizaÃ§Ãµes** regulares5. **Considerar integraÃ§Ãµes** com outros sistemas## SuportePara suporte durante a migraÃ§Ã£o:1. **Consulte os logs** primeiro2. **Teste em ambiente de desenvolvimento**3. **Mantenha backups** dos dados originais4. **Documente as configuraÃ§Ãµes** especÃ­ficas do seu ambiente---**MigraÃ§Ã£o do Sistema Help Desk Controll IT** - LocalStorage para Banco de Dados + API