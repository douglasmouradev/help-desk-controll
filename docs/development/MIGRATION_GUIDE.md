# Guia de Migração - Sistema Help Desk TITANIUMEste guia explica como migrar do sistema atual (que usa LocalStorage) para o sistema completo com banco de dados e API backend.## Visão Geral da Migração### Sistema Atual (LocalStorage)- ✅ Frontend completo e funcional- ❌ Dados armazenados apenas no navegador- ❌ Sem persistência entre dispositivos- ❌ Sem controle de usuários centralizado### Sistema Completo (Banco + API)- ✅ Frontend completo e funcional- ✅ Banco de dados MySQL/MariaDB- ✅ API RESTful em PHP- ✅ Autenticação JWT segura- ✅ Persistência de dados- ✅ Controle de usuários centralizado- ✅ Logs de auditoria- ✅ Sistema de permissões robusto## Passos da Migração### 1. Preparação do Ambiente#### Instalar Dependências```bash# Ubuntu/Debiansudo apt updatesudo apt install apache2 php php-mysql php-json php-curl php-mbstring php-openssl mysql-server -y# CentOS/RHELsudo yum install httpd php php-mysqlnd php-json php-curl php-mbstring php-openssl mariadb-server -y```#### Configurar Banco de Dados```bash# Conectar ao MySQLmysql -u root -p# Criar bancoCREATE DATABASE helpdesk_titanium CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;CREATE USER 'helpdesk_user'@'localhost' IDENTIFIED BY 'senha_segura_123';GRANT ALL PRIVILEGES ON helpdesk_titanium.* TO 'helpdesk_user'@'localhost';FLUSH PRIVILEGES;```### 2. Estrutura de Arquivos#### Organizar Arquivos```/var/www/html/helpdesk/├── api/                    # Backend PHP│   ├── config.php         # Configurações│   ├── auth.php           # Autenticação│   ├── tickets.php        # Gestão de chamados│   ├── users.php          # Gestão de usuários│   └── index.php          # Router da API├── uploads/               # Arquivos enviados├── index.html             # Frontend (atual)├── styles.css             # CSS (atual)├── script-api.js          # JavaScript com API (novo)├── script.js              # JavaScript original (manter como backup)└── favicon.svg            # Ícone (atual)```### 3. Configuração do Backend#### Configurar Conexão com Banco```php// Editar api/config.phpdefine('DB_HOST', 'localhost');define('DB_NAME', 'helpdesk_titanium');define('DB_USER', 'helpdesk_user');define('DB_PASS', 'senha_segura_123');define('JWT_SECRET', 'sua_chave_secreta_muito_forte_aqui');```#### Importar Estrutura do Banco```bash# Importar schemamysql -u root -p helpdesk_titanium < database_schema.sql```### 4. Migração do Frontend#### Atualizar index.html```html<!-- Substituir a linha do script --><!-- DE: --><script src="script.js"></script><!-- PARA: --><script src="script-api.js"></script>```#### Configurar URL da API```javascript// No script-api.js, linha 7this.apiBaseUrl = '/api/';  // Para produção// outhis.apiBaseUrl = 'http://localhost/helpdesk/api/';  // Para desenvolvimento```### 5. Migração de Dados (Opcional)Se você tem dados importantes no sistema atual, pode migrá-los:#### Script de Migração de Dados```php<?php// migrate-data.phprequire_once 'api/config.php';function migrateLocalStorageData() {    $db = new Database();    $conn = $db->getConnection();        // Dados de exemplo para migração    $demoUsers = [        [            'name' => 'Usuário Padrão',            'email' => 'usuario@controllit.com.br',            'username' => 'usuario',            'password' => password_hash('senha123', PASSWORD_DEFAULT),            'user_type' => 'user'        ],        [            'name' => 'Agente de Suporte',            'email' => 'suporte@controllit.com.br',            'username' => 'suporte',            'password' => password_hash('senha123', PASSWORD_DEFAULT),            'user_type' => 'support'        ],        [            'name' => 'Administrador',            'email' => 'admin@controllit.com.br',            'username' => 'admin',            'password' => password_hash('senha123', PASSWORD_DEFAULT),            'user_type' => 'admin'        ]    ];        foreach ($demoUsers as $user) {        $stmt = $conn->prepare("            INSERT INTO users (name, email, username, password_hash, user_type)             VALUES (?, ?, ?, ?, ?)        ");        $stmt->execute([            $user['name'],            $user['email'],            $user['username'],            $user['password'],            $user['user_type']        ]);    }        echo "Usuários migrados com sucesso!\n";}migrateLocalStorageData();?>```### 6. Configuração do Servidor Web#### Apache Virtual Host```apache<VirtualHost *:80>    ServerName helpdesk.Controll IT.com    DocumentRoot /var/www/html/helpdesk        <Directory /var/www/html/helpdesk>        AllowOverride All        Require all granted    </Directory>        # Configurar CORS para API    <Directory /var/www/html/helpdesk/api>        Header always set Access-Control-Allow-Origin "*"        Header always set Access-Control-Allow-Methods "GET, POST, PUT, DELETE, OPTIONS"        Header always set Access-Control-Allow-Headers "Content-Type, Authorization"    </Directory></VirtualHost>```#### Configurar .htaccess```apache# /var/www/html/helpdesk/.htaccessRewriteEngine On# Redirecionar API requestsRewriteCond %{REQUEST_URI} ^/api/(.*)$RewriteRule ^api/(.*)$ api/index.php [QSA,L]# Servir arquivos estáticosRewriteCond %{REQUEST_FILENAME} !-fRewriteCond %{REQUEST_FILENAME} !-dRewriteRule ^(.*)$ index.html [QSA,L]```### 7. Teste da Migração#### Verificar Funcionamento1. **Acesse o sistema:** `http://helpdesk.Controll IT.com`2. **Teste login:** Use as credenciais padrão3. **Crie um chamado:** Verifique se é salvo no banco4. **Verifique logs:** `/var/log/apache2/error.log`#### Testar API```bash# Teste de logincurl -X POST http://helpdesk.Controll IT.com/api/auth/login \  -H "Content-Type: application/json" \  -d '{"username":"admin","password":"senha123"}'# Teste de listagem de chamadoscurl -X GET http://helpdesk.Controll IT.com/api/tickets \  -H "Authorization: Bearer SEU_TOKEN_AQUI"```### 8. Configurações de Produção#### Segurança```bash# Configurar HTTPSsudo certbot --apache -d helpdesk.Controll IT.com# Configurar firewallsudo ufw allow 22/tcpsudo ufw allow 80/tcpsudo ufw allow 443/tcpsudo ufw enable```#### Backup```bash# Script de backup automático#!/bin/bashDATE=$(date +%Y%m%d_%H%M%S)mysqldump -u root -p helpdesk_titanium > /backup/helpdesk_$DATE.sqltar -czf /backup/helpdesk_files_$DATE.tar.gz /var/www/html/helpdesk```## Comparação: Antes vs Depois### Funcionalidades Mantidas- ✅ Interface visual idêntica- ✅ Todos os recursos do frontend- ✅ Responsividade- ✅ Navegação entre páginas- ✅ Modais e interações### Melhorias Adicionadas- 🔒 **Segurança:** Autenticação JWT, validação server-side- 💾 **Persistência:** Dados salvos no banco de dados- 👥 **Multi-usuário:** Controle centralizado de usuários- 📊 **Relatórios:** Analytics e estatísticas avançadas- 📝 **Auditoria:** Logs de todas as atividades- 🔄 **Escalabilidade:** API permite integração com outros sistemas### Novas Funcionalidades- **Upload de arquivos:** Anexos nos chamados- **Comentários internos:** Para agentes de suporte- **Histórico de alterações:** Rastreamento completo- **Notificações:** Sistema de alertas- **API RESTful:** Integração com sistemas externos## Rollback (Volta ao Sistema Anterior)Se necessário voltar ao sistema anterior:### 1. Restaurar Frontend Original```bash# Fazer backup do atualcp index.html index-api.htmlcp script-api.js script-api-backup.js# Restaurar originalcp index.html.backup index.html# Alterar script para usar script.js original```### 2. Limpar Banco de Dados (Opcional)```sqlDROP DATABASE helpdesk_titanium;```### 3. Restaurar Configuração Apache```bash# Desabilitar sitesudo a2dissite helpdesk.confsudo systemctl reload apache2```## Troubleshooting### Problemas Comuns#### 1. Erro 404 na API```bash# Verificar configuração do Apachesudo apache2ctl -S# Verificar .htaccesscat /var/www/html/helpdesk/.htaccess```#### 2. Erro de CORS```bash# Verificar headerscurl -I http://helpdesk.Controll IT.com/api/tickets# Verificar configuração CORS no Apache```#### 3. Erro de Conexão com Banco```bash# Testar conexãomysql -u helpdesk_user -p -h localhost helpdesk_titanium# Verificar logs do MySQLsudo tail -f /var/log/mysql/error.log```#### 4. Token JWT Inválido```javascript// Verificar configuração no script-api.jsthis.apiBaseUrl = '/api/';  // Deve estar correto// Verificar JWT_SECRET no config.phpdefine('JWT_SECRET', 'sua_chave_secreta_muito_forte_aqui');```### Logs para Debug```bash# Logs do Apachesudo tail -f /var/log/apache2/helpdesk_error.log# Logs do PHPsudo tail -f /var/log/php8.0-fpm.log# Logs do MySQLsudo tail -f /var/log/mysql/error.log# Logs da aplicação (tabela access_logs)mysql -u root -p helpdesk_titanium -e "SELECT * FROM access_logs ORDER BY created_at DESC LIMIT 10;"```## Próximos PassosApós a migração bem-sucedida:1. **Treinar usuários** nas novas funcionalidades2. **Configurar backups** automáticos3. **Implementar monitoramento** do sistema4. **Planejar atualizações** regulares5. **Considerar integrações** com outros sistemas## SuportePara suporte durante a migração:1. **Consulte os logs** primeiro2. **Teste em ambiente de desenvolvimento**3. **Mantenha backups** dos dados originais4. **Documente as configurações** específicas do seu ambiente---**Migração do Sistema Help Desk Controll IT** - LocalStorage para Banco de Dados + API