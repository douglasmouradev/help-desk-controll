# ðŸš€ Guia de Deploy - Sistema Help Desk Controll IT## ðŸ“‹ PrÃ©-requisitos### Servidor Web- **Apache 2.4+** ou **Nginx 1.18+**- **PHP 7.4+** (recomendado PHP 8.0+)- **MySQL 5.7+** ou **MariaDB 10.3+**- **SSL Certificate** (Let's Encrypt recomendado)### ExtensÃµes PHP NecessÃ¡rias```bash# Ubuntu/Debiansudo apt install php-mysql php-json php-curl php-mbstring php-openssl php-gd php-zip# CentOS/RHELsudo yum install php-mysqlnd php-json php-curl php-mbstring php-openssl php-gd php-zip```## ðŸ”§ InstalaÃ§Ã£o Passo a Passo### 1. Preparar Servidor```bash# Atualizar sistemasudo apt update && sudo apt upgrade -y# Instalar dependÃªnciassudo apt install apache2 mysql-server php php-mysql php-json php-curl php-mbstring php-openssl php-gd php-zip unzip -y# Habilitar mod_rewritesudo a2enmod rewritesudo a2enmod headerssudo a2enmod sslsudo systemctl restart apache2```### 2. Configurar Banco de Dados```bash# Conectar ao MySQLsudo mysql -u root -p# Criar banco e usuÃ¡rioCREATE DATABASE helpdesk_titanium CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;CREATE USER 'helpdesk_user'@'localhost' IDENTIFIED BY 'senha_super_segura_123';GRANT ALL PRIVILEGES ON helpdesk_titanium.* TO 'helpdesk_user'@'localhost';FLUSH PRIVILEGES;EXIT;```### 3. Deploy do Sistema```bash# Criar diretÃ³rio do projetosudo mkdir -p /var/www/html/helpdeskcd /var/www/html/helpdesk# Fazer upload dos arquivos (via Git, FTP, etc.)# git clone https://github.com/douglasmouradev/help-desk-Controll IT.git .# Configurar permissÃµessudo chown -R www-data:www-data /var/www/html/helpdesksudo chmod -R 755 /var/www/html/helpdesksudo chmod -R 777 /var/www/html/helpdesk/uploadssudo chmod -R 777 /var/www/html/helpdesk/logs```### 4. Configurar Banco de Dados```bash# Importar schemamysql -u helpdesk_user -p helpdesk_titanium < database_schema.sql# Inserir dados iniciaismysql -u helpdesk_user -p helpdesk_titanium -e "INSERT INTO ticket_categories (name, description) VALUES('Hardware', 'Problemas relacionados a equipamentos fÃ­sicos'),('Software', 'Problemas com programas e aplicativos'),('Rede', 'Problemas de conectividade e infraestrutura de rede'),('E-mail', 'Problemas com sistema de e-mail'),('Outros', 'Outros tipos de problemas');INSERT INTO ticket_priorities (name, level, color) VALUES('Baixa', 1, '#10b981'),('MÃ©dia', 2, '#f59e0b'),('Alta', 3, '#ef4444'),('CrÃ­tica', 4, '#dc2626');INSERT INTO ticket_statuses (name, slug, color, is_final) VALUES('Aberto', 'aberto', '#3b82f6', 0),('Em Andamento', 'em_andamento', '#f59e0b', 0),('Fechado', 'fechado', '#10b981', 1);INSERT INTO users (name, email, username, password_hash, user_type) VALUES('Administrador', 'admin@controllit.com.br', 'admin', '\$2y\$12\$LQv3c1yqBWVHxkd0LHAkCOYz6TtxMQJqhN8/LewdBPj4J/8QzK8i2', 'admin'),('Suporte', 'suporte@controllit.com.br', 'suporte', '\$2y\$12\$LQv3c1yqBWVHxkd0LHAkCOYz6TtxMQJqhN8/LewdBPj4J/8QzK8i2', 'support'),('UsuÃ¡rio Teste', 'usuario@controllit.com.br', 'usuario', '\$2y\$12\$LQv3c1yqBWVHxkd0LHAkCOYz6TtxMQJqhN8/LewdBPj4J/8QzK8i2', 'user');"```### 5. Configurar Sistema```bash# Copiar configuraÃ§Ã£o de produÃ§Ã£ocp config.production.php api/config.php# Editar configuraÃ§Ãµesnano api/config.php# Configurar variÃ¡veis importantes:# - DB_HOST, DB_NAME, DB_USER, DB_PASS# - JWT_SECRET (gerar nova chave)# - SMTP_HOST, SMTP_USERNAME, SMTP_PASSWORD# - SYSTEM_EMAIL, SYSTEM_URL```### 6. Configurar Apache```bash# Criar virtual hostsudo nano /etc/apache2/sites-available/helpdesk.conf``````apache<VirtualHost *:80>    ServerName helpdesk.Controll IT.com    DocumentRoot /var/www/html/helpdesk        <Directory /var/www/html/helpdesk>        AllowOverride All        Require all granted    </Directory>        ErrorLog ${APACHE_LOG_DIR}/helpdesk_error.log    CustomLog ${APACHE_LOG_DIR}/helpdesk_access.log combined</VirtualHost><VirtualHost *:443>    ServerName helpdesk.Controll IT.com    DocumentRoot /var/www/html/helpdesk        <Directory /var/www/html/helpdesk>        AllowOverride All        Require all granted    </Directory>        SSLEngine on    SSLCertificateFile /etc/letsencrypt/live/helpdesk.Controll IT.com/fullchain.pem    SSLCertificateKeyFile /etc/letsencrypt/live/helpdesk.Controll IT.com/privkey.pem        ErrorLog ${APACHE_LOG_DIR}/helpdesk_ssl_error.log    CustomLog ${APACHE_LOG_DIR}/helpdesk_ssl_access.log combined</VirtualHost>``````bash# Habilitar sitesudo a2ensite helpdesk.confsudo systemctl reload apache2```### 7. Configurar SSL (Let's Encrypt)```bash# Instalar Certbotsudo apt install certbot python3-certbot-apache -y# Obter certificadosudo certbot --apache -d helpdesk.Controll IT.com# Configurar renovaÃ§Ã£o automÃ¡ticasudo crontab -e# Adicionar: 0 12 * * * /usr/bin/certbot renew --quiet```### 8. Configurar Email (SMTP)```bash# Instalar Postfix (opcional)sudo apt install postfix -y# Ou configurar para usar Gmail/Outlook# Editar api/config.php com credenciais SMTP```## ðŸ”’ ConfiguraÃ§Ãµes de SeguranÃ§a### 1. Firewall```bash# Configurar UFWsudo ufw enablesudo ufw allow 22/tcpsudo ufw allow 80/tcpsudo ufw allow 443/tcpsudo ufw deny 3306/tcp```### 2. MySQL Security```bash# Executar script de seguranÃ§asudo mysql_secure_installation# Configurar bind-addresssudo nano /etc/mysql/mysql.conf.d/mysqld.cnf# bind-address = 127.0.0.1sudo systemctl restart mysql```### 3. PHP Security```bash# Configurar php.inisudo nano /etc/php/8.0/apache2/php.ini# ConfiguraÃ§Ãµes importantes:# expose_php = Off# display_errors = Off# log_errors = On# upload_max_filesize = 10M# post_max_size = 10M# max_execution_time = 300```## ðŸ“Š Monitoramento e Backup### 1. Backup AutomÃ¡tico```bash# Criar script de backupsudo nano /usr/local/bin/helpdesk-backup.sh``````bash#!/bin/bashDATE=$(date +%Y%m%d_%H%M%S)BACKUP_DIR="/backup/helpdesk"DB_NAME="helpdesk_titanium"DB_USER="helpdesk_user"DB_PASS="senha_super_segura_123"mkdir -p $BACKUP_DIR# Backup do bancomysqldump -u $DB_USER -p$DB_PASS $DB_NAME > $BACKUP_DIR/db_$DATE.sql# Backup dos arquivostar -czf $BACKUP_DIR/files_$DATE.tar.gz /var/www/html/helpdesk# Limpar backups antigos (manter 30 dias)find $BACKUP_DIR -name "*.sql" -mtime +30 -deletefind $BACKUP_DIR -name "*.tar.gz" -mtime +30 -deleteecho "Backup completed: $DATE"``````bash# Tornar executÃ¡velsudo chmod +x /usr/local/bin/helpdesk-backup.sh# Configurar cron (backup diÃ¡rio Ã s 2h)sudo crontab -e# Adicionar: 0 2 * * * /usr/local/bin/helpdesk-backup.sh```### 2. Monitoramento```bash# Instalar ferramentas de monitoramentosudo apt install htop iotop nethogs -y# Configurar logrotatesudo nano /etc/logrotate.d/helpdesk``````/var/www/html/helpdesk/logs/*.log {    daily    missingok    rotate 30    compress    delaycompress    notifempty    create 644 www-data www-data}```## ðŸš€ Teste de Deploy### 1. Verificar Funcionamento```bash# Testar APIcurl -X POST http://helpdesk.Controll IT.com/api/auth.php?action=login \  -H "Content-Type: application/json" \  -d '{"username":"admin","password":"senha123"}'# Testar uploadcurl -X POST http://helpdesk.Controll IT.com/api/tickets.php \  -H "Authorization: Bearer SEU_TOKEN" \  -F "title=Teste" \  -F "description=Teste de upload" \  -F "category_id=1" \  -F "priority_id=2" \  -F "attachments[]=@/path/to/file.jpg"```### 2. Verificar Logs```bash# Logs do Apachesudo tail -f /var/log/apache2/helpdesk_error.log# Logs do sistemasudo tail -f /var/www/html/helpdesk/logs/error.log# Logs do MySQLsudo tail -f /var/log/mysql/error.log```## ðŸ”§ ManutenÃ§Ã£o### 1. AtualizaÃ§Ãµes```bash# Backup antes de atualizarsudo /usr/local/bin/helpdesk-backup.sh# Atualizar sistemacd /var/www/html/helpdeskgit pull origin main# Atualizar banco se necessÃ¡riomysql -u helpdesk_user -p helpdesk_titanium < database_schema.sql# Reiniciar serviÃ§ossudo systemctl restart apache2sudo systemctl restart mysql```### 2. Limpeza```bash# Limpar logs antigossudo find /var/www/html/helpdesk/logs -name "*.log" -mtime +30 -delete# Limpar uploads antigossudo find /var/www/html/helpdesk/uploads -mtime +90 -delete# Otimizar bancomysql -u helpdesk_user -p helpdesk_titanium -e "OPTIMIZE TABLE tickets, users, ticket_comments;"```## ðŸ“ž Suporte### Credenciais PadrÃ£o- **Admin:** admin / senha123- **Suporte:** suporte / senha123  - **UsuÃ¡rio:** usuario / senha123### URLs Importantes- **Sistema:** https://helpdesk.Controll IT.com- **API:** https://helpdesk.Controll IT.com/api/- **Logs:** /var/www/html/helpdesk/logs/- **Uploads:** /var/www/html/helpdesk/uploads/### Comandos Ãšteis```bash# Status dos serviÃ§ossudo systemctl status apache2 mysql# Reiniciar serviÃ§ossudo systemctl restart apache2 mysql# Verificar espaÃ§o em discodf -h# Verificar uso de memÃ³riafree -h# Verificar processosps aux | grep php```## âœ… Checklist de Deploy- [ ] Servidor configurado com Apache, PHP, MySQL- [ ] Banco de dados criado e populado- [ ] Arquivos do sistema copiados- [ ] PermissÃµes configuradas- [ ] SSL configurado- [ ] Email SMTP configurado- [ ] Backup automÃ¡tico configurado- [ ] Monitoramento configurado- [ ] Testes realizados- [ ] DocumentaÃ§Ã£o atualizada**ðŸŽ‰ Sistema pronto para produÃ§Ã£o!**