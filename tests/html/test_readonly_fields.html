<!DOCTYPE html><html lang="pt-BR"><head>    <meta charset="UTF-8">    <meta name="viewport" content="width=device-width, initial-scale=1.0">    <title>Teste Campos Readonly</title>    <style>        body {            font-family: Arial, sans-serif;            max-width: 600px;            margin: 50px auto;            padding: 20px;        }        .form-group {            margin-bottom: 15px;        }        label {            display: block;            margin-bottom: 5px;            font-weight: bold;        }        input {            width: 100%;            padding: 8px;            border: 1px solid #ddd;            border-radius: 4px;            box-sizing: border-box;        }        input[readonly] {            background-color: #f5f5f5;        }        button {            background-color: #007bff;            color: white;            padding: 10px 20px;            border: none;            border-radius: 4px;            cursor: pointer;            margin-top: 10px;        }        button:hover {            background-color: #0056b3;        }        .log {            background-color: #f8f9fa;            padding: 15px;            border-radius: 4px;            margin-top: 20px;            font-family: monospace;            font-size: 12px;            max-height: 300px;            overflow-y: auto;            border: 1px solid #ddd;        }        .test-section {            border: 1px solid #ddd;            padding: 15px;            margin-bottom: 20px;            border-radius: 4px;        }    </style></head><body>    <h1>Teste de Preenchimento de Campos Readonly</h1>        <div class="test-section">        <h3>Teste 1: Campos Readonly (como no sistema original)</h3>        <div class="form-group">            <label for="zipcode1">CEP:</label>            <input type="text" id="zipcode1" placeholder="Digite o CEP (ex: 01310-100)" maxlength="9">            <button type="button" id="searchBtn1">Buscar CEP</button>        </div>                <div class="form-group">            <label for="address1">Endereço (readonly):</label>            <input type="text" id="address1" readonly>        </div>                <div class="form-group">            <label for="city1">Cidade (readonly):</label>            <input type="text" id="city1" readonly>        </div>                <div class="form-group">            <label for="state1">Estado (readonly):</label>            <input type="text" id="state1" readonly>        </div>    </div>        <div class="test-section">        <h3>Teste 2: Campos Normais (sem readonly)</h3>        <div class="form-group">            <label for="zipcode2">CEP:</label>            <input type="text" id="zipcode2" placeholder="Digite o CEP (ex: 01310-100)" maxlength="9">            <button type="button" id="searchBtn2">Buscar CEP</button>        </div>                <div class="form-group">            <label for="address2">Endereço (normal):</label>            <input type="text" id="address2">        </div>                <div class="form-group">            <label for="city2">Cidade (normal):</label>            <input type="text" id="city2">        </div>                <div class="form-group">            <label for="state2">Estado (normal):</label>            <input type="text" id="state2">        </div>    </div>        <div class="log" id="log">        Aguardando teste...    </div>    <script>        function log(message) {            const logDiv = document.getElementById('log');            const timestamp = new Date().toLocaleTimeString();            logDiv.innerHTML += `[${timestamp}] ${message}<br>`;            logDiv.scrollTop = logDiv.scrollHeight;        }        async function searchCep(testNumber) {            log(`=== TESTE ${testNumber}: INICIANDO BUSCA DE CEP ===`);                        const zipcodeInput = document.getElementById(`zipcode${testNumber}`);            const addressInput = document.getElementById(`address${testNumber}`);            const cityInput = document.getElementById(`city${testNumber}`);            const stateInput = document.getElementById(`state${testNumber}`);                        if (!zipcodeInput) {                log(`ERRO: Campo CEP não encontrado para teste ${testNumber}`);                return;            }                        const zipcode = zipcodeInput.value.replace(/\D/g, '');            log(`CEP digitado: ${zipcode}`);                        if (zipcode.length !== 8) {                log(`ERRO: CEP deve ter 8 dígitos`);                alert('CEP deve ter 8 dígitos');                return;            }                        try {                log('Fazendo requisição para ViaCEP...');                const url = `https://viacep.com.br/ws/${zipcode}/json/`;                log(`URL: ${url}`);                                const response = await fetch(url);                log(`Status: ${response.status}`);                                if (!response.ok) {                    throw new Error(`HTTP ${response.status}`);                }                                const data = await response.json();                log(`Dados recebidos: ${JSON.stringify(data)}`);                                if (data.erro) {                    log('ERRO: CEP não encontrado');                    alert('CEP não encontrado');                    return;                }                                // Preencher campos com método melhorado                if (addressInput) {                    let endereco = data.logradouro || '';                    if (data.complemento) endereco += ', ' + data.complemento;                    if (data.bairro) endereco += ' - ' + data.bairro;                                        const enderecoFinal = endereco.trim();                    log(`Endereço a preencher: ${enderecoFinal}`);                                        // Verificar se é readonly                    const isReadonly = addressInput.hasAttribute('readonly');                    log(`Campo address é readonly: ${isReadonly}`);                                        if (isReadonly) {                        addressInput.removeAttribute('readonly');                        log('Atributo readonly removido temporariamente');                    }                                        addressInput.value = enderecoFinal;                    addressInput.setAttribute('value', enderecoFinal);                    addressInput.dispatchEvent(new Event('input', { bubbles: true }));                    addressInput.dispatchEvent(new Event('change', { bubbles: true }));                                        if (isReadonly) {                        addressInput.setAttribute('readonly', 'readonly');                        log('Atributo readonly restaurado');                    }                                        log(`Endereço preenchido: "${addressInput.value}"`);                    log(`Valor do atributo: "${addressInput.getAttribute('value')}"`);                }                                if (cityInput) {                    const cidade = data.localidade || '';                    const isReadonly = cityInput.hasAttribute('readonly');                                        if (isReadonly) {                        cityInput.removeAttribute('readonly');                    }                                        cityInput.value = cidade;                    cityInput.setAttribute('value', cidade);                    cityInput.dispatchEvent(new Event('input', { bubbles: true }));                    cityInput.dispatchEvent(new Event('change', { bubbles: true }));                                        if (isReadonly) {                        cityInput.setAttribute('readonly', 'readonly');                    }                                        log(`Cidade preenchida: "${cityInput.value}"`);                }                                if (stateInput) {                    const estado = data.uf || '';                    const isReadonly = stateInput.hasAttribute('readonly');                                        if (isReadonly) {                        stateInput.removeAttribute('readonly');                    }                                        stateInput.value = estado;                    stateInput.setAttribute('value', estado);                    stateInput.dispatchEvent(new Event('input', { bubbles: true }));                    stateInput.dispatchEvent(new Event('change', { bubbles: true }));                                        if (isReadonly) {                        stateInput.setAttribute('readonly', 'readonly');                    }                                        log(`Estado preenchido: "${stateInput.value}"`);                }                                log(`SUCESSO: Teste ${testNumber} concluído!`);                            } catch (error) {                log(`ERRO: ${error.message}`);                alert('Erro: ' + error.message);            }        }        // Event listeners        document.getElementById('searchBtn1').addEventListener('click', () => searchCep(1));        document.getElementById('searchBtn2').addEventListener('click', () => searchCep(2));                // Formatação automática do CEP        document.getElementById('zipcode1').addEventListener('input', function(e) {            let value = e.target.value.replace(/\D/g, '');            if (value.length >= 5) {                e.target.value = value.replace(/(\d{5})(\d{0,3})/, '$1-$2');            } else {                e.target.value = value;            }                        if (value.length === 8) {                log('CEP completo detectado, buscando automaticamente...');                setTimeout(() => searchCep(1), 500);            }        });                document.getElementById('zipcode2').addEventListener('input', function(e) {            let value = e.target.value.replace(/\D/g, '');            if (value.length >= 5) {                e.target.value = value.replace(/(\d{5})(\d{0,3})/, '$1-$2');            } else {                e.target.value = value;            }                        if (value.length === 8) {                log('CEP completo detectado, buscando automaticamente...');                setTimeout(() => searchCep(2), 500);            }        });                log('Página carregada e listeners configurados');        log('Teste com CEP: 01310-100 (Av. Paulista, São Paulo/SP)');    </script></body></html>