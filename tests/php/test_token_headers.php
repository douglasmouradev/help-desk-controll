<?php// Teste espec√≠fico para verificar se o token est√° sendo passado corretamenteecho "<h1>üîç Teste de Headers e Token</h1>";// 1. Verificar se getallheaders() funcionaecho "<h2>1. Teste de getallheaders():</h2>";if (function_exists('getallheaders')) {    echo "<p style='color: green;'>‚úÖ getallheaders() dispon√≠vel</p>";    $headers = getallheaders();    echo "<p>Headers dispon√≠veis:</p>";    echo "<pre>" . print_r($headers, true) . "</pre>";} else {    echo "<p style='color: red;'>‚ùå getallheaders() n√£o dispon√≠vel</p>";}// 2. Verificar $_SERVERecho "<h2>2. Headers via \$_SERVER:</h2>";echo "<p>Headers HTTP:</p>";echo "<pre>";foreach ($_SERVER as $key => $value) {    if (strpos($key, 'HTTP_') === 0) {        echo $key . ": " . $value . "\n";    }}echo "</pre>";// 3. Testar se o token est√° sendo recebidoecho "<h2>3. Teste de Token:</h2>";$token = null;// Tentar getallheaders() primeiroif (function_exists('getallheaders')) {    $headers = getallheaders();    $authHeader = $headers['Authorization'] ?? $headers['authorization'] ?? '';} else {    $authHeader = $_SERVER['HTTP_AUTHORIZATION'] ?? '';}if (preg_match('/Bearer\s(\S+)/', $authHeader, $matches)) {    $token = $matches[1];    echo "<p style='color: green;'>‚úÖ Token encontrado: " . substr($token, 0, 50) . "...</p>";} else {    echo "<p style='color: red;'>‚ùå Token n√£o encontrado</p>";    echo "<p>Header Authorization: " . ($authHeader ?: 'N√£o encontrado') . "</p>";}// 4. Testar login e usar o tokenecho "<h2>4. Teste Completo:</h2>";$loginData = json_encode([    'username' => 'admin',    'password' => 'Controll IT@10']);$loginContext = stream_context_create([    'http' => [        'method' => 'POST',        'header' => 'Content-Type: application/json',        'content' => $loginData    ]]);try {    $loginResponse = file_get_contents('http://localhost/sistema-web-Controll IT/api/auth.php?action=login', false, $loginContext);        if ($loginResponse === false) {        echo "<p style='color: red;'>‚ùå Erro no login</p>";    } else {        $loginData = json_decode($loginResponse, true);        if ($loginData['success']) {            $testToken = $loginData['data']['token'];            echo "<p style='color: green;'>‚úÖ Login bem-sucedido</p>";            echo "<p>Token: " . substr($testToken, 0, 50) . "...</p>";                        // Testar tickets com token            echo "<h3>Testando API de tickets com token:</h3>";            $ticketsContext = stream_context_create([                'http' => [                    'method' => 'GET',                    'header' => 'Authorization: Bearer ' . $testToken . "\r\n" .                               'Content-Type: application/json'                ]            ]);                        $ticketsResponse = file_get_contents('http://localhost/sistema-web-Controll IT/api/tickets.php', false, $ticketsContext);                        if ($ticketsResponse === false) {                echo "<p style='color: red;'>‚ùå Erro na API de tickets</p>";            } else {                $ticketsData = json_decode($ticketsResponse, true);                echo "<p>Resposta da API de tickets:</p>";                echo "<pre>" . htmlspecialchars($ticketsResponse) . "</pre>";                                if ($ticketsData && isset($ticketsData['success']) && $ticketsData['success']) {                    echo "<p style='color: green;'>‚úÖ API de tickets funcionando!</p>";                } else {                    echo "<p style='color: red;'>‚ùå API de tickets falhou</p>";                }            }        } else {            echo "<p style='color: red;'>‚ùå Login falhou</p>";        }    }} catch (Exception $e) {    echo "<p style='color: red;'>‚ùå Erro: " . $e->getMessage() . "</p>";}echo "<hr>";echo "<h2>üìã Resultado:</h2>";echo "<p>Se todos os testes estiverem com ‚úÖ, o problema est√° resolvido!</p>";echo "<p>Se houver ‚ùå, me informe qual √© o problema espec√≠fico.</p>";?>